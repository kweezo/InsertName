cmake_minimum_required(VERSION 3.20)

project(InsertName)
if(WIN32)
    include_directories(".\\lib\\win\\")
    include_directories(".\\lib\\win\\libpqxx-master\\build\\install\\include")
    include_directories(".\\lib\\win\\openssl-3.2.1\\include")
    link_directories(".\\lib\\win\\GLFW\\lib-mingw-w64")
    link_directories(".\\lib\\win\\x86_64-w64-mingw32\\lib")
    link_directories(".\\lib\\win\\VulkanSDK\\1.3.275.0\\Lib")
    link_directories(".\\lib\\win\\libpqxx-master\\build\\install\\lib")
endif()

set(CMAKE_CXX_STANDARD 20)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
set(CMAKE_RUNTIME_OUTPUT_DIRECTORY bin)

option(BUILD_CLIENT "Build the client executable" OFF)
option(BUILD_INSTALLER "Build the installer executable" OFF)
option(BUILD_SERVER "Build the server executable" OFF)
option(DEBUG "Build with debug flags" OFF)
option(GFX_RECONSTRUCT "Build with graphics reconstruction" OFF)

if(DEBUG)
    set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -g -DNDEBUG")
endif()

if(GFX_RECONSTRUCT)
    add_definitions(-DGFX_RECONSTRUCT)
endif()

if(BUILD_INSTALLER)
    file(GLOB installersrc src/installer/**/*.cpp src/settings.cpp )
    add_executable(installer ${installersrc} src/installer/main.cpp)
target_compile_features(installer  PUBLIC cxx_std_230)
endif()

if(BUILD_SERVER)
    file(GLOB serversrc src/server/*.cpp)
    add_executable(server ${serversrc} src/server/main.cpp)

    if(WIN32)
        target_link_libraries(server PUBLIC pqxx)
        target_link_libraries(server PUBLIC pq)
        target_link_libraries(server PUBLIC ws2_32)
        target_link_libraries(server PUBLIC ssl)
        target_link_libraries(server PUBLIC crypto)
    endif()
endif()

if(BUILD_CLIENT)    
    file(GLOB clientsrc src/client/renderer/core/*.cpp src/client/renderer/ext/*.cpp src/client/renderer/window/*.cpp src/client/account/*.cpp)
    add_executable(client ${clientsrc} src/client/main.cpp src/settings.cpp)
    
    if(WIN32)
        target_link_libraries(client PUBLIC glfw3)
        target_link_libraries(client PUBLIC glfw3dll)
        target_link_libraries(client PUBLIC gdi32)
        target_link_libraries(client PUBLIC vulkan-1)
        target_link_libraries(client PUBLIC ws2_32)
        target_link_libraries(client PUBLIC ssl)
        target_link_libraries(client PUBLIC crypto)
    elseif(UNIX AND NOT APPLE)
        target_link_libraries(client PUBLIC glfw)
        target_link_libraries(client PUBLIC assimp)
        target_link_libraries(client PUBLIC vulkan)
        target_link_libraries(client PUBLIC ssl)
        target_link_libraries(client PUBLIC crypto)
    endif()
endif()
set_target_properties(client PROPERTIES CXX_STANDARD 20 CXX_STANDARD_REQUIRED ON)